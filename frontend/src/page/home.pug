extends ../layout/main-layout.pug

block content
    div
        span
            h1 Good you are home again.
            h1 #{userLoggedIn.firstName}
            div(style='display: flex;')
                .profileimg.col-1
                    img(src=userLoggedIn.picture, alt="ujwalpic", style='height: min-content;')
                .textarea.col-11
                    input#exampleTextBox.form-control(type='text', placeholder='Enter text')
            button#postButton.btn.btn-primary(type='button', disabled='') Post
        #responseContainer
        script.
            document.addEventListener('DOMContentLoaded', function () {
                console.log('DOMContentLoaded event triggered');
                
                const exampleTextBox = document.getElementById('exampleTextBox');
                const postButton = document.getElementById('postButton');
                const responseContainer = document.getElementById('responseContainer');
                
                exampleTextBox.addEventListener('input', function () {
                    console.log('Input event triggered');
                    postButton.disabled = this.value.trim() === ''; // Enable button if there's text in the input
                });
                
                postButton.addEventListener('click', async function () {
                    console.log('Post button clicked');
                    const textContent = exampleTextBox.value.trim();
                    // Check if there is content before making the POST request
                    if (textContent) {
                        console.log('Sending POST request...');
                        // Continue with your fetch logic here
                        try {
                            const response = await fetch('/api/posts', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ content: textContent }),
                            });
                            
                            const data = await response.json();
                            console.log('Post successful:', data);

                            // Check if the response status is 200 or 201
                            if (response.status === 200 || response.status === 201) {
                                // Create HTML elements for success message and prepend to responseContainer
                                const successMessage = `<img src=${data.picture} alt="ujwal pic"><p style="color: green;"> ${data.message}</p><p style="color: green;"> ${data.username}</p><p style="color: green;"> ${data.createdAt}</p>`;
                                responseContainer.insertAdjacentHTML('afterbegin', successMessage);
                            }
                        } catch (error) {
                            console.error('Error posting:', error);
                            // Handle the error as needed
                        }
                    }
                });
            })
        style.
            .profileimg {
                min-width: 75px; /* Fixed width for the column */
                min-height: 75px; /* Minimum height for the column */
            }
            .profileimg img {
                width: 100%; /* Make the image take 100% of the column width */
                height: 100%; /* Make the image take 100% of the column height */
                object-fit: cover; /* Maintain aspect ratio and cover the container */
            }
